<?xml version="1.0" encoding="UTF-8" ?>
<constraint-mapping
        xmlns="http://symfony.com/schema/dic/constraint-mapping"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://symfony.com/schema/dic/constraint-mapping
                        http://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd">

    <class name="Ekyna\Bundle\ProductBundle\Entity\Attribute">
        <property name="group">
            <constraint name="NotNull"/>
        </property>
        <property name="name">
            <constraint name="NotBlank"/>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="media">
            <constraint name="Ekyna\Bundle\MediaBundle\Validator\Constraints\MediaTypes">
                <option name="types">
                    <value>image</value>
                    <value>svg</value>
                </option>
            </constraint>
        </property>
        <!-- Unique name per group -->
        <!--<constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>group</value>
                <value>name</value>
            </option>
        </constraint>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\AttributeTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\AttributeGroup">
        <property name="name">
            <constraint name="NotBlank"/>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <!-- Unique name -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">name</option>
        </constraint>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\AttributeGroupTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\AttributeSet">
        <property name="name">
            <constraint name="NotBlank"/>
        </property>
        <property name="slots">
            <constraint name="Valid"/>
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <!-- Unique name -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">name</option>
        </constraint>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\AttributeSlot">
        <property name="set">
            <constraint name="NotNull"/>
        </property>
        <property name="group">
            <constraint name="NotNull"/>
        </property>
        <!-- Unique group per set -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>set</value>
                <value>group</value>
            </option>
        </constraint>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\Brand">
        <property name="name">
            <constraint name="NotBlank"/>
            <constraint name="Length">
                <option name="max">64</option>
            </constraint>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="media">
            <constraint name="Ekyna\Bundle\MediaBundle\Validator\Constraints\MediaTypes">
                <option name="types">
                    <value>image</value>
                    <value>svg</value>
                </option>
            </constraint>
        </property>
        <property name="seo">
            <constraint name="NotNull"/>
            <constraint name="Valid"/>
        </property>
        <!-- Unique name -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>name</value>
            </option>
        </constraint>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\BrandTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
            <constraint name="Length">
                <option name="max">64</option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\BundleChoice">
        <property name="slot">
            <constraint name="NotNull"/>
        </property>
        <property name="product">
            <constraint name="NotNull">
                <option name="groups">
                    <value>bundle</value>
                </option>
            </constraint>
            <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\ProductType">
                <option name="groups">
                    <value>bundle</value>
                </option>
                <option name="types">
                    <value>simple</value>
                    <value>variant</value>
                    <value>bundle</value>
                </option>
            </constraint>
            <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\ProductType">
                <option name="groups">
                    <value>configurable</value>
                </option>
                <option name="types">
                    <value>simple</value>
                    <value>variable</value>
                    <value>variant</value>
                    <value>bundle</value>
                </option>
            </constraint>
        </property>
        <property name="minQuantity">
            <constraint name="NotNull"/>
            <constraint name="GreaterThan">
                <option name="value">0</option>
            </constraint>
        </property>
        <property name="maxQuantity">
            <constraint name="NotNull"/>
            <constraint name="GreaterThan">
                <option name="value">0</option>
                <option name="groups">
                    <value>configurable</value>
                </option>
            </constraint>
        </property>
        <property name="rules">
            <constraint name="Valid"/>
        </property>
        <!-- TODO options -->
        <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\BundleChoice"/>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\BundleChoiceRule">
        <property name="choice">
            <constraint name="NotNull"/>
        </property>
        <property name="type">
            <constraint name="NotBlank"/>
            <constraint name="Callback">
                <value>Ekyna\Bundle\ProductBundle\Model\BundleChoiceRuleTypes</value>
                <value>isValidType</value>
            </constraint>
        </property>
        <!-- TODO expression validation
        <property name="expression">
            <constraint name="Valid"/>
        </property>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\BundleSlot">
        <property name="bundle">
            <constraint name="NotNull"/>
            <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\ProductType">
                <option name="types">
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>
        <property name="choices">
            <constraint name="Valid"/>
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
                <option name="groups">
                    <value>configurable</value>
                </option>
            </constraint>
        </property>
        <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\BundleSlot"/>

        <!-- TODO translations -->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\BundleSlotTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
        </property>
        <property name="description">
            <constraint name="NotBlank"/>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\Category">
        <property name="name">
            <constraint name="NotBlank"/>
            <constraint name="Length">
                <option name="max">64</option>
            </constraint>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="media">
            <constraint name="Ekyna\Bundle\MediaBundle\Validator\Constraints\MediaTypes">
                <option name="types">
                    <value>image</value>
                    <value>svg</value>
                </option>
            </constraint>
        </property>
        <property name="seo">
            <constraint name="NotNull"/>
            <constraint name="Valid"/>
        </property>
        <!-- Unique name -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>name</value>
            </option>
        </constraint>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\CategoryTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
            <constraint name="Length">
                <option name="max">64</option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\Option">
        <group-sequence-provider />
        <property name="group">
            <constraint name="NotNull">
                <option name="groups">data</option>
            </constraint>
        </property>
        <property name="product">
            <constraint name="NotNull">
                <option name="groups">product</option>
            </constraint>
            <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\ProductType">
                <option name="groups">product</option>
                <option name="types">
                    <value>simple</value>
                    <value>variant</value>
                    <value>bundle</value>
                </option>
            </constraint>
        </property>
        <property name="designation">
            <constraint name="NotBlank">
                <option name="groups">data</option>
            </constraint>
            <constraint name="Length">
                <option name="min">3</option>
                <option name="max">255</option>
                <option name="groups">data</option>
            </constraint>
        </property>
        <property name="reference">
            <constraint name="NotBlank">
                <option name="groups">data</option>
            </constraint>
            <constraint name="Length">
                <option name="max">16</option>
                <option name="groups">data</option>
            </constraint>
        </property>
        <property name="netPrice">
            <constraint name="NotBlank">
                <option name="groups">data</option>
            </constraint>
            <constraint name="GreaterThanOrEqual">
                <option name="value">0</option>
                <option name="groups">
                    <value>data</value>
                    <value>product</value>
                </option>
            </constraint>
        </property>
        <property name="weight">
            <constraint name="NotBlank">
                <option name="groups">data</option>
            </constraint>
            <constraint name="GreaterThanOrEqual">
                <option name="value">0</option>
                <option name="groups">data</option>
            </constraint>
        </property>
        <property name="taxGroup">
            <constraint name="NotNull">
                <option name="groups">data</option>
            </constraint>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
                <option name="groups">data</option>
            </constraint>
        </property>
        <!-- Unique reference -->
        <!-- TODO bug because option group may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>group</value>
                <value>reference</value>
            </option>
            <option name="groups">data</option>
        </constraint>-->
        <!-- Unique designation per group -->
        <!-- TODO bug because option group may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>group</value>
                <value>designation</value>
            </option>
            <option name="groups">data</option>
        </constraint>-->
        <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\Option"/>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\OptionTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\OptionGroup">
        <property name="name">
            <constraint name="NotBlank"/>
        </property>
        <property name="options">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
            <constraint name="Valid"/>
        </property>
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <!-- Unique name per product -->
        <!-- TODO bug because product may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>product</value>
                <value>name</value>
            </option>
        </constraint>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\OptionGroupTranslation">
        <property name="title">
            <constraint name="NotBlank"/>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\Pricing">
        <property name="groups">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="countries">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="brands">
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="rules">
            <constraint name="Valid"/>
            <constraint name="Count">
                <option name="min">1</option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\PricingRule">
        <property name="pricing">
            <constraint name="NotNull"/>
        </property>
        <property name="minQuantity">
            <constraint name="NotBlank"/>
            <constraint name="Range">
                <option name="min">1</option>
            </constraint>
        </property>
        <property name="percent">
            <constraint name="NotBlank"/>
            <constraint name="Range">
                <option name="min">0</option>
                <option name="max">100</option>
            </constraint>
        </property>
        <!-- TODO bug because pricing may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>pricing</value>
                <value>minQuantity</value>
            </option>
        </constraint>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\Product">

        <!--
        !!! Don't forget to always use both 'Default' AND '[product.type]' validations groups !!!
        -->

        <!-- Type -->
        <property name="type">
            <constraint name="NotBlank"/>
            <constraint name="Callback">
                <value>Ekyna\Bundle\ProductBundle\Model\ProductTypes</value>
                <value>isValid</value>
            </constraint>
        </property>

        <!-- Reference -->
        <property name="reference">
            <constraint name="Length">
                <option name="max">16</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variant</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Designation -->
        <property name="designation">
            <constraint name="NotBlank">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <constraint name="Length">
                <option name="min">3</option>
                <option name="max">128</option>
            </constraint>
        </property>

        <!-- Net price -->
        <property name="netPrice">
            <constraint name="GreaterThanOrEqual">
                <option name="value">0</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variant</value>
                </option>
            </constraint>
        </property>

        <!-- Weight -->
        <property name="weight">
            <constraint name="GreaterThanOrEqual">
                <option name="value">0</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variant</value>
                </option>
            </constraint>
        </property>

        <!-- Tax group -->
        <property name="taxGroup">
            <constraint name="NotNull">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <!--
                    Set by persistence events handlers
                    <value>variant</value>
                    -->
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Parent -->
        <property name="parent">
            <constraint name="NotNull">
                <option name="groups">
                    <value>variant</value>
                </option>
            </constraint>
            <constraint name="IsNull">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Variants -->
        <property name="variants">
            <constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variant</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Attribute set -->
        <property name="attributeSet">
            <constraint name="NotNull">
                <option name="groups">
                    <value>variable</value>
                </option>
            </constraint>
            <constraint name="IsNull">
                <option name="groups">
                    <value>simple</value>
                    <value>variant</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- (Variant) Attributes -->
        <property name="attributes">
            <constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <!--
            Attribute slots can be optional
            <constraint name="Count">
                <option name="min">1</option>
                <option name="groups">
                    <value>variant</value>
                </option>
            </constraint>
            -->
        </property>

        <!-- Option groups -->
        <property name="optionGroups">
            <constraint name="Valid"/>
        </property>

        <!-- Bundle slots -->
        <property name="bundleSlots">
            <constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>variant</value>
                </option>
            </constraint>
            <constraint name="Count">
                <option name="min">1</option>
                <option name="groups">
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <constraint name="Valid"/>
        </property>

        <!-- Brand -->
        <property name="brand">
            <constraint name="NotNull">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Categories (none for variants) -->
        <property name="categories">
            <!--<constraint name="Count">
                <option name="min">1</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>-->
            <constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>variant</value>
                </option>
            </constraint>
        </property>

        <!-- Seo (null for variants) -->
        <property name="seo">
            <constraint name="NotNull">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <constraint name="IsNull">
                <option name="groups">
                    <value>variant</value>
                </option>
            </constraint>
            <constraint name="Valid"/>
        </property>

        <!-- Translations -->
        <property name="translations">
            <constraint name="Count">
                <option name="min">1</option>
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <!--<constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>variant</value>
                </option>
            </constraint>-->
        </property>

        <!-- Medias -->
        <property name="medias">
            <constraint name="Valid"/>
        </property>

        <!-- References -->
        <property name="references">
            <constraint name="Valid"/>
            <constraint name="Count">
                <option name="max">0</option>
                <option name="groups">
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
        </property>

        <!-- Variant (attributes) validation -->
        <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\Variant">
            <option name="groups">variant</option>
        </constraint>

        <!-- Product validation -->
        <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\Product">
            <option name="groups">
                <value>simple</value>
                <value>variant</value>
                <value>variable</value>
                <value>bundle</value>
                <value>configurable</value>
            </option>
        </constraint>

        <!-- Bundle (or configurable) validation -->
        <!-- TODO At least one required slot -->

        <!-- Stock subject validation -->
        <constraint name="Ekyna\Component\Commerce\Bridge\Symfony\Validator\Constraints\StockSubject">
            <option name="groups">
                <value>simple</value>
                <value>variant</value>
                <value>variable</value>
                <value>bundle</value>
                <value>configurable</value>
            </option>
        </constraint>

        <!-- Unique constraints -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">reference</option>
        </constraint>
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">designation</option>
            <option name="groups">
                <value>simple</value>
                <value>variable</value>
                <value>bundle</value>
                <value>configurable</value>
            </option>
        </constraint>
        <!-- TODO bug because parent may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>parent</value>
                <value>designation</value>
            </option>
            <option name="groups">variant</option>
        </constraint>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\ProductAdjustment">
        <property name="type">
            <constraint name="Choice">
                <option name="choices">
                    <value>included</value>
                </option>
            </constraint>
        </property>
        <property name="mode">
            <constraint name="Choice">
                <option name="choices">
                    <value>flat</value>
                </option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\ProductMedia">
        <property name="media">
            <constraint name="NotNull"/>
            <constraint name="Ekyna\Bundle\MediaBundle\Validator\Constraints\MediaTypes">
                <option name="types">
                    <value>image</value>
                    <value>svg</value>
                    <value>video</value>
                    <value>flash</value>
                    <value>file</value>
                </option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\ProductTranslation">
        <property name="title">
            <constraint name="NotBlank">
                <option name="groups">
                    <value>simple</value>
                    <value>variable</value>
                    <value>bundle</value>
                    <value>configurable</value>
                </option>
            </constraint>
            <constraint name="Length">
                <option name="min">3</option>
                <option name="max">128</option>
            </constraint>
        </property>
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\ProductReference">
        <property name="type">
            <constraint name="Callback">
                <value>Ekyna\Bundle\ProductBundle\Model\ProductReferenceTypes</value>
                <value>isValid</value>
            </constraint>
        </property>
        <property name="number">
            <constraint name="NotBlank"/>
            <!-- TODO validate regarding to the type -->
        </property>

        <!-- Unique number constraint -->
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>number</value>
            </option>
            <option name="groups">
                <value>Default</value>
                <value>simple</value>
                <value>variant</value>
            </option>
        </constraint>
        <!-- Unique type by product constraint -->
        <!-- TODO bug because product may not have an identifier ...
        <constraint name="Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity">
            <option name="fields">
                <value>type</value>
                <value>product</value>
            </option>
            <option name="groups">
                <value>Default</value>
                <value>simple</value>
                <value>variant</value>
            </option>
        </constraint>-->
    </class>

    <class name="Ekyna\Bundle\ProductBundle\Entity\ProductStockUnit">
        <property name="product">
            <constraint name="NotNull"/>
            <constraint name="Ekyna\Bundle\ProductBundle\Validator\Constraints\ProductType">
                <option name="types">
                    <value>simple</value>
                    <value>variant</value>
                </option>
            </constraint>
        </property>
    </class>

</constraint-mapping>
