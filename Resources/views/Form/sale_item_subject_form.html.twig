{{ bootstrap_set_style('horizontal') }}
{{ bootstrap_set_col_size('xs') }}

{{ form_errors(form) }}

{% if form.variant is defined %}
    {{ form_widget(form.variant) }}
{% elseif form.configuration is defined %}
    {{ form_widget(form.configuration) }}
{% endif %}

{% if form.options is defined %}
    {{ form_widget(form.options) }}
    <hr>
{% endif %}

{% set pricing = form.vars.pricing %}

<div class="row sale-item-pricing" data-pricing='{{ pricing|json_encode }}'>
    <div class="col-xs-6">
        {{ form_row(form.quantity, {'label_col': 4, 'widget_col': 8}) }}
        {% if 0 < pricing.rules|length %}
        <div class="form-group sale-item-price" style="display: none;">
            <label class="control-label col-xs-4" for="sale_item_subject_configure_price">
                {{ 'ekyna_core.field.price'|trans }}
            </label>
            <div class="col-xs-8">
                <p id="sale_item_subject_configure_price" class="form-control-static sale-item-price-total"></p>
                <p class="help-block">
                    {{ 'ekyna_product.sale_item_configure.unit_net_price'|trans }}<br>
                    <em class="sale-item-price-help"></em>
                </p>
            </div>
        </div>
        {% endif %}
        {{ form_row(form.submit, {'label_col': 4, 'widget_col': 8}) }}
    </div>
    <div class="col-xs-6">
        {% if 0 < pricing.rules|length %}
        <table class="table table-striped table-condensed sale-item-rules" style="display: none;">
            <thead>
            <tr>
                <th>{{ 'ekyna_core.field.quantity'|trans }}</th>
                <th>{{ 'ekyna_product.sale_item_configure.discount'|trans }}</th>
                <th>{{ 'ekyna_product.sale_item_configure.unit_net_price'|trans }}</th>
            </tr>
            </thead>
            <tbody>
            {% set rules = pricing.rules|reverse %}
            {% for rule in rules %}
                <tr data-quantity="{{ rule.quantity }}" data-percent="{{ rule.percent }}">
                    <td>
                        {% if loop.last %}
                            {{ 'ekyna_product.sale_item_configure.from'|trans({'{{min}}': rule.quantity}) }}
                        {% else %}
                            {{ 'ekyna_product.sale_item_configure.range'|trans({
                                '{{min}}': rule.quantity,
                                '{{max}}': (rules[loop.index0 + 1].quantity -1)
                            }) }}
                        {% endif %}
                    </td>
                    <td>{{ rule.percent }}%</td>
                    <td>{{ (pricing.net_price * (100 - rule.percent) / 100)|localizedcurrency(pricing['currency']) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="form-group sale-item-price" style="display: none;">
            <label class="control-label col-xs-4" for="sale_item_subject_configure_price">
                {{ 'ekyna_core.field.price'|trans }}
            </label>
            <div class="col-xs-8">
                <p id="sale_item_subject_configure_price" class="form-control-static sale-item-price-total"></p>
                <p class="help-block">
                    {{ 'ekyna_product.sale_item_configure.unit_net_price'|trans }}
                    <em class="sale-item-price-help"></em>
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{{ form_rest(form) }}
