{{ bootstrap_set_style('horizontal') }}
{{ bootstrap_set_col_size('xs') }}

{{ form_errors(form) }}

{% if form.variant is defined %}
    {{ form_widget(form.variant) }}
{% elseif form.configuration is defined %}
    {{ form_widget(form.configuration) }}
{% endif %}

{% if form.options is defined %}
    {{ form_widget(form.options) }}
{% endif %}

{% set pricing = form.vars.pricing %}

<div class="row">
    <div class="col-xs-6">
        {{ form_row(form.quantity, {'label_col': 4, 'widget_col': 8}) }}
        {{ form_row(form.submit, {'label_col': 4, 'widget_col': 8}) }}
    </div>
    <div class="col-xs-6">
        <div class="form-group">
            <label class="control-label col-xs-4 required"
                   for="sale_item_subject_configure_price">
                {{ 'ekyna_core.field.price'|trans }}
            </label>
            <div class="col-xs-8">
                <div class="input-group">
                    <span id="sale_item_subject_configure_price"
                          class="form-control sale-item-price"
                          data-pricing='{{ pricing|json_encode }}'>
                        {{ pricing['net_price']|localizedcurrency(pricing['currency']) }}
                    </span>
                    <span class="input-group-btn">
                        <button class="btn btn-default sale-item-toggle-pricing" type="button">
                            <span class="fa fa-list"></span>
                        </button>
                    </span>
                </div>
                {% if pricing.rules is not empty %}
                    <table class="table table-striped table-condensed sale-item-pricing" style="display: none;">
                        <tr>
                            <th>Quantité</th>
                            <th>Remise</th>
                            <th>Prix net HT</th>
                        </tr>

                        {% set rules = pricing.rules|reverse %}
                        {% for rule in rules %}
                            <tr data-quantity="{{ rule.quantity }}" data-percent="{{ rule.percent }}">
                                <td>
                                    {% if loop.last %}
                                        à partir de {{ rule.quantity }}
                                    {% else %}
                                        {{ rule.quantity }} à {{ (rules[loop.index0 + 1].quantity -1) }}
                                    {% endif %}
                                </td>
                                <td>{{ rule.percent }}%</td>
                                <td>{{ (pricing.net_price * (100 - rule.percent) / 100)|localizedcurrency(pricing['currency']) }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{{ form_rest(form) }}
