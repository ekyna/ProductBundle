define(["jquery","gsap/TimelineLite"],function(a,b){function c(a){var b=a.find("> .wrap"),c=Math.floor(.045*b.width()),d=Math.floor(.055*b.width());12>c?(c=12,d=15):24<c&&(c=24,d=30),b.find(".slide-caption").css({fontSize:c+"px",lineHeight:d+"px"})}function d(c){function d(){j||(l.seek("end"+i,!0),i++,i>k.length-1&&(i=0),c.one("product-slide-complete",function(){l.seek("start"+i,!0)}))}function e(){j||(l.seek("end"+i),i--,0>i&&(i=k.length-1),c.one("product-slide-complete",function(){l.seek("start"+i,!0)}))}var f=.3,g=.15,h=6,i=0,j=!1,k=c.find(".slide"),l=new b({onComplete:function(){this.restart()}});h=c.find(".slides").data("duration"),h>1e3?h/=1e3:h=4,k.each(function(d){var e=a(this),k=e.find(".slide-image"),m=e.find(".slide-caption"),n=e.find(".slide-button"),o=0,p=new b({data:{index:d},onStart:function(){e.show()},onComplete:function(){e.hide(),c.trigger("product-slide-complete")}});p.call(function(){i=this.data.index,j=!0},null,p,o),p.from(k,f,{left:40,right:-40,opacity:0},o),p.from(m,f,{left:-40,right:40,opacity:0},o+g),p.from(n,f,{scale:.5,opacity:0},o+2*g),o+=f+2*g,p.call(function(){j=!1},null,null,o),o+=h,p.call(function(){j=!0},null,p,o),p.to(n,f,{scale:.5,opacity:0},o),p.to(m,f,{left:40,right:-40,opacity:0},o+g),p.to(k,f,{left:-40,right:40,opacity:0},o+2*g),o+=f+2*g,p.call(function(){j=!1},null,null,o),l.add(p).addLabel("start"+d,d*(2*f+4*g+h)).addLabel("end"+d,d*(2*f+4*g+h)+f+2*g+h)}),c.on("click","a.prev-slide",e),c.on("click","a.next-slide",d),l.seek(f+2*g)}var e=!1;return{init:function(b){if(b.each(function(){var b=a(this);d(b),c(b)}),0<b.length&&!e){var f=null,g=function(){a(".product-slide").each(function(){c(a(this))})};a(window).on("resize",function(){f&&clearTimeout(f),f=setTimeout(g,300)}),e=!0}}}});