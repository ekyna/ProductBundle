define(["jquery","ekyna-number"],function(a){"use strict";return a.fn.saleItemSubjectConfigureWidget=function(){return this.each(function(){function b(){1===m.length&&(m.find("> tbody > tr").removeClass("success"),a.each(n.rules,function(a,b){if(o>=parseFloat(b.quantity))return p=b,m.find('> tbody > tr[data-quantity="'+b.quantity+'"]').addClass("success"),!1}))}function c(){var a=q*o;null!==p&&(a*=(100-parseFloat(p.percent))/100),k.html(a.formatPrice(n.currency))}function d(){m.find("tr").each(function(){var b=q*(100-a(this).data("percent"))/100;a(this).find("td:last-child").html(b.formatPrice(n.currency))})}function e(){o=parseFloat(j.val()||1),b(),c(),f()}function f(){var b=[];i.each(function(){var c=a(this).val();if(0<=c){var d=a(this).find('option[value="'+c+'"]');1===d.length&&0<d.data("price")&&b.push(parseFloat(d.data("price")).toLocaleString())}});var c="";0<b.length&&(b.unshift(parseFloat(n.net_price).toLocaleString()),c+="<br>"+b.join(" + ")+" = "),c+=q.formatPrice(n.currency),null!==p&&null!==p&&(c+="<br>- "+parseFloat(p.percent).toLocaleString()+"% = "+(q*(100-p.percent)/100).formatPrice(n.currency)),l.html(c)}function g(){q=parseFloat(n.net_price),i.each(function(){var b=a(this).val();if(0<=b){var c=a(this).find('option[value="'+b+'"]');1===c.length&&0<c.data("price")&&(q+=parseFloat(c.data("price")))}}),d(),c(),f()}var h=a(this),i=h.find("select.sale-item-option"),j=h.find("input.sale-item-quantity"),k=h.find("p.sale-item-price-total"),l=h.find("em.sale-item-price-help"),m=h.find("table.sale-item-rules"),n=h.find("div.sale-item-pricing").data("pricing"),o=parseFloat(j.val()||1),p=null;if(!(n.hasOwnProperty("rules")&&n.hasOwnProperty("net_price")&&n.hasOwnProperty("currency")))return void console.log("Invalid pricing data.");var q=parseFloat(n.net_price);h.find("div.sale-item-price").show(),m.show(),i.on("change",g),j.on("keyup mouseup change",e),b(),g()}),this},{init:function(a){a.saleItemSubjectConfigureWidget()}}});