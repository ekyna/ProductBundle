define(["require","jquery","ekyna-product/templates","ekyna-polyfill"],function(a,b,c){"use strict";function d(a,b,c){this.level=a,this.message=b,this.qty=void 0===c?0:c}function e(a,c){var d=null;return b.each(a,function(a,e){if(0===e.length)return!0;var f="all"===a.substring(a.lastIndexOf("_")+1),g=f;b.each(e,function(a,b){if(c[b.s].$radio.filter("[data-index="+b.c+"]").is(":checked")){if(!f)return g=!0,!1}else if(f)return g=!0,!1});var h=a.substring(0,a.indexOf("_"));return g?(d=h,!1):("show"===h&&(d="hide"),!0)}),d}function f(a,b){if(this.$element=a,this.$element.data("bundleSlot",this),void 0===b)throw"Invalid 'parentItem' argument";this.parentItem=b,this.init()}function g(a,b){if(this.$element=a,this.$element.data("optionGroup",this),this.$select=this.$element.find("select"),this.locked=!!this.$select.attr("data-locked"),this.option=void 0,this.$image=void 0,this.id=this.$element.data("id"),this.name=this.$select.attr("name"),!b)throw"Invalid 'optionGroups' argument";this.optionGroups=b,this.init()}function h(a,b){if(this.$element=a,this.$element.data("optionGroups",this),this.name=this.$element.attr("name"),!b)throw"Invalid 'item' argument";this.item=b,this.init()}function i(a,b){if(this.$element=a,this.$element.data("variant",this),this.$image=void 0,this.$info=void 0,this.name=this.$element.attr("name"),!b)throw"Invalid 'item' argument";this.item=b,this.init()}function j(a,b){this.$element=a,this.$element.data("saleItem",this),this.parentItem=b,this.id=this.$element.attr("id"),this.name=this.$element.attr("name"),this.availability={},this.originalPrice=0,this.finalPrice=0,this.$variant=this.variant=void 0,this.init()}var k=function(a,b){a.prop("disabled",b).find("input, select, button, textarea").not('[data-locked="1"]').prop("disabled",b)},l={price:0,offers:[],taxes:[]};l.currency="USD",l.mode="ati",l.calculate=function(a,c,d){if("number"!=typeof this.price||0>this.price)return 0;(void 0===a||1>a)&&(a=1),void 0===c&&(c=!0),void 0===d&&(d=!0);var e="ati"===l.mode?this.price:Math.fRound(this.price,2),f=void 0;if(d||(e*=a),c&&(Array.isArray(this.offers)&&(f=this.offers.find(function(b){return b.min_qty<=a})),f&&(e-=Math.fRound(e*f.percent/100,2))),Array.isArray(this.taxes)&&"ati"===l.mode){var g=e;b.each(this.taxes,function(a,b){e+=Math.fRound(g*b/100,2)})}return e},l.display=function(a){var b=l.calculate.call(this,a),c=l.calculate.call(this,a,!1),d="";return c!==b&&(d="<del>"+c.localizedCurrency(l.currency)+"</del>&nbsp;"),d+"<strong>"+b.localizedCurrency(l.currency)+"</strong>&nbsp;<sup>"+("ati"===l.mode?j.trans.ati:j.trans.net)+"</sup>"},d.prototype.getClass=function(){return 3===this.level?"error":0<this.level?"warning":null},d.prototype.hasClass=function(){return 0<this.level},d.prototype.display=function(){return this.message&&0<this.message.length?"<span>"+this.message+"</span>":""},d.prototype.merge=function(a){a&&(a.level>this.level||0===a.level&&a.level===this.level&&a.qty<this.qty)&&(this.level=a.level,this.message=a.message,this.qty=a.qty)};var m={o_msg:"",min_qty:0,min_msg:"",max_qty:0,max_msg:"",a_qty:0,a_msg:"",r_qty:0,r_msg:""};return m.resolve=function(a){if(!this)return new d(0);void 0===a&&(a=1);var b="INF"===this.max_qty?Number.POSITIVE_INFINITY:this.max_qty;return a>b?new d(3,this.max_msg):a<this.min_qty?new d(3,this.min_msg):a>this.a_qty?this.r_msg&&a<=this.a_qty+this.r_qty?new d(1,this.r_msg):new d(2,this.o_msg):new d(0,this.a_msg,this.a_qty)},b.extend(f.prototype,{init:function(){this.busy=!1,this.config=b.extend({required:!1,rules:{}},this.$element.data("config")),this.hidden=!1,this.required=this.config.required,this.$radio=this.$element.find(".slot-buttons input[type=radio]"),this.$label=this.$element.find(".slot-buttons label"),this.$prev=this.$element.find(".slot-choices > a.prev"),this.$next=this.$element.find(".slot-choices > a.next"),this.$element.find(".slot-choice-form[disabled]").each(function(){k(b(this),!0)}),this.clearChoice(),this.bindEvents(),this.selectChoice()},bindEvents:function(){if(0!==this.$radio.size()){var a=this;this.$radio.on("change",function(b){return a.selectChoice(),b.preventDefault(),b.stopPropagation(),!1}),this.$label.on("click",function(b){if(a.busy)return b.preventDefault(),b.stopPropagation(),!1}),this.$prev.on("click",function(c){if(a.busy)return c.preventDefault(),c.stopPropagation(),!1;var d=a.$radio.filter(":checked").data("index"),e=b(a.$radio.filter(":not(:disabled)").get().reverse()),f=null;e.each(function(){if(d>b(this).data("index"))return f=b(this),!1}),f&&0!==f.size()||(f=e.first()),f.prop("checked",!0),a.selectChoice()}),this.$next.on("click",function(c){if(a.busy)return c.preventDefault(),c.stopPropagation(),!1;var d=a.$radio.filter(":checked").data("index"),e=a.$radio.filter(":not(:disabled)"),f=null;e.each(function(){if(d<b(this).data("index"))return f=b(this),!1}),f&&0!==f.size()||(f=e.first()),f.prop("checked",!0),a.selectChoice()})}},unbindEvents:function(){0!==this.$radio.size()&&(this.$radio.off("change"),this.$label.off("click"),this.$prev.off("click"),this.$next.off("click"))},destroy:function(){this.unbindEvents(),this.$element.removeData(),this.$choice&&this.$choice.data("saleItem")&&this.$choice.data("saleItem").destroy()},show:function(){if(this.hidden){this.busy=!0,this.hidden=!1;var a=this;this.$element.slideDown(250,function(){a.busy=!1})}},hide:function(){if(!this.hidden){this.busy=!0,this.hidden=!0;var a=this;this.$element.slideUp(250,function(){a.busy=!1});var b=this.$radio.filter('[value=""]').eq(0);b.is(":not(:checked)")&&(b.prop("checked",!0),this.selectChoice())}},toggleRequired:function(a){if(a){if(this.required)return;return this.required=!0,this.$radio.filter('[value=""]').eq(0).prop("disabled",!0).parent("li").hide(),void k(this.$element.find('.slot-choice-form[data-id="0"]').hide(),!0)}this.required&&(this.required=!1,this.$radio.filter('[value=""]').eq(0).prop("disabled",!1).parent("li").show(),k(this.$element.find('.slot-choice-form[data-id="0"]'),!1))},selectChoice:function(){if(0===this.$radio.size())return this.$choice=this.$element.find(".slot-choice-form").saleItem(this.parentItem),void(this.choice=this.$choice.data("saleItem"));this.$radio.filter(":checked").is(":disabled")&&this.$radio.filter(":not(:disabled)").eq(0).prop("checked",!0);var a=this,b=a.$choice,c=a.choice,d=this.$radio.filter(":checked:not(:disabled)").val()||0,e=this.$element.find('.slot-choice-form[data-id="'+d+'"]');if(0!==e.size()&&e!==b){this.busy=!0;var f=function(){k(e,!1),a.$choice=e,1===a.$choice.find("input.sale-item-quantity").size()?(a.$choice.saleItem(a.parentItem),a.choice=a.$choice.data("saleItem")):a.choice=void 0,a.$choice.show().fadeIn(250),a.$element.trigger("change"),a.busy=!1};b?b.fadeOut(250,function(){c&&c.destroy(),k(b,!0),f()}):f()}},updateState:function(){var a=this.parentItem.bundleSlots,c=!1,d=this;switch(this.$radio.filter(':not([value=""])').each(function(){var f=b(this),g=f.data("rules");if("hide"===e(g,a)){if(f.is(":disabled"))return;f.prop("disabled",!0).parent("li").hide(),k(d.$element.find('.slot-choice-form[data-id="'+f.prop("val")+'"]').hide(),!0),c=!0}else{if(f.is(":not(:disabled)"))return;f.prop("disabled",!1).parent("li").show(),k(d.$element.find('.slot-choice-form[data-id="'+f.prop("val")+'"]').show(),!1),c=!0}}),e(this.config.rules,a)){case"hide":this.toggleRequired(!1),this.hide(),c=!0;break;case"show":this.toggleRequired(!1),this.show(),c=!0;break;case"required":this.toggleRequired(!0),this.show(),c=!0;break;default:this.toggleRequired(!1),this.show()}return c&&this.$radio.filter(":checked").eq(0).is(":disabled")&&this.selectChoice(),c},updateQuantity:function(){this.choice&&this.choice.onQuantityChange()},hasChoice:function(){return void 0!==this.choice},getChoice:function(){return this.choice},clearChoice:function(){this.$choice=void 0,this.choice=void 0}}),b.fn.bundleSlot=function(a){return this.each(function(){void 0===b(this).data("bundleSlot")&&new f(b(this),a)})},b.extend(g.prototype,{init:function(){this.optionGroups.item.$gallery&&(this.$image=this.optionGroups.item.$gallery.find('a[data-option-id="'+this.$element.data("id")+'"]'),0===this.$image.size()&&(this.$image=b('<a data-option-id="'+this.$element.data("id")+'"><img></a>'),this.$image.appendTo(this.optionGroups.item.$gallery.find(".item-gallery-children")))),this.$info=this.$element.find(".sale-item-info"),this.updateState(),this.selectOption(),this.bindEvents()},updateState:function(){return this.isRequired()&&1===this.getChoiceCount()&&this.hide(),this.locked?void this.$select.prop("disabled",!0):void this.$select.prop("disabled",!1)},bindEvents:function(){var a=this;this.$select.on("change",function(b){return b.preventDefault(),b.stopPropagation(),a.selectOption(),!1})},selectOption:function(){this.optionGroups.$element.trigger("pre_change",[this.option,this.getId()]),this.option=void 0;var a=this.$select.find('option[value="'+this.$select.val()+'"]');1===a.length&&a.data("config")?(this.option=b.extend({id:this.$select.val(),label:null,thumb:null,image:null,pricing:null,availability:null,product:null,groups:[]},a.data("config")),this.$image&&(this.option.thumb?this.$image.show().attr("href",this.option.image).attr("title",a.text()).find("img").attr("src",this.option.thumb):this.$image.hide())):this.$image&&this.$image.hide(),this.updatePricesAndAvailability(),this.optionGroups.$element.trigger("post_change",[this.option,this.getId()])},updatePricesAndAvailability:function(){if(this.$info.empty(),this.$element.removeClass("has-error has-warning"),this.hasOption()){var a=this.getTotalQuantity(),b="",c="";if(this.option.availability){var d=m.resolve.call(this.option.availability,a);d.hasClass()&&this.$element.addClass("has-"+d.getClass()),c=d.display()}this.option.pricing&&(b=l.display.call(this.option.pricing,a)),this.$info.html(c+b)}},getTotalQuantity:function(){return this.optionGroups.item.getTotalQuantity()},unbindEvents:function(){this.$select.off("change")},destroy:function(){this.unbindEvents(),this.$image&&this.$image.remove(),this.$element.removeData()},getId:function(){return this.id},getName:function(){return this.name},hasOption:function(){return!this.locked&&!!this.option},getOption:function(){return this.option},getChoiceCount:function(){return this.$select.find('option[value]:not([value=""])').length},getAvailability:function(){return this.hasOption()?this.option.availability:null},getOriginalPrice:function(){return this.hasOption()?l.calculate.call(this.option.pricing,this.optionGroups.item.getTotalQuantity(),!1):0},getFinalPrice:function(){return this.hasOption()?l.calculate.call(this.option.pricing,this.optionGroups.item.getTotalQuantity()):0},isLocked:function(){return this.locked},isRequired:function(){return this.$select.prop("required")},getPosition:function(){var a=parseInt(this.$element.data("position")),b=this.getParent();return b instanceof i?a=10*(a+this.optionGroups.getRootGroupsMaxPosition()+1):b instanceof g?a+=b.getPosition()+1:a*=10,a},getParentId:function(){return this.$element.data("parent")},getParent:function(){var a=this.$element.data("parent");if("variant"===a)return this.optionGroups.item.variant;if(0<a){var b=this.optionGroups.$element.find('> .form-group[data-id="'+a+'"]');if(1===b.length)return b.data("optionGroup")}return null},lock:function(){return this.locked||(this.$select.attr("data-locked","1"),this.locked=!0),this},unlock:function(){return this.locked&&(this.$select.attr("data-locked","0"),this.locked=!1),this},hide:function(){return this.$element.hide(),this.$image&&this.$image.size()&&this.$image.hide(),this},show:function(){return this.$element.show(),this.$image&&this.$image.size()&&this.$image.show(),this}}),b.fn.optionGroup=function(a){return this.each(function(){void 0===b(this).data("optionGroup")&&new g(b(this),a)})},b.extend(h.prototype,{init:function(){this.loadGroups()},loadGroups:function(){var a=this;this.$groups=[],this.groups=[],this.$element.find(" > .form-group").each(function(){var c=b(this).optionGroup(a);a.$groups.push(c),a.groups.push(c.data("optionGroup"))})},getGroups:function(){return this.groups},destroy:function(){b.each(this.groups,function(){this.destroy()}),this.$element.removeData()},getOriginalPrice:function(){var a=0;return b.each(this.groups,function(){this.isLocked()||(a+=this.getOriginalPrice())}),a},getFinalPrice:function(){var a=0;return b.each(this.groups,function(){this.isLocked()||(a+=this.getFinalPrice())}),a},createGroups:function(a,c){var d=this,e=!1;b.each(a,function(a,b){e|=d.createGroup(b,c)}),e&&this.sortGroups()},createGroup:function(a,d){if(!a.hasOwnProperty("id"))return!1;var e=this.$element.find('> .form-group[data-id="'+a.id+'"]');if(1===e.size())return e.data("optionGroup").show().unlock().updateState(),e.attr("data-parent",d),!1;a.parent=this.name,e=b(c["@EkynaProduct/Js/sale_item_option_group.html.twig"].render(a)),e.appendTo(this.$element),e.optionGroup(this),e.attr("data-parent",d);var f=e.data("optionGroup");return this.$groups.push(e),this.groups.push(f),!0},lockGroups:function(a){return this.$element.find('> .form-group[data-parent="'+a+'"]').each(function(){b(this).data("optionGroup").hide().lock().updateState()}),this},resolveAvailability:function(){var a=null;return b.each(this.groups,function(){if(!this.isLocked()&&this.hasOption()){var b=m.resolve.call(this.getAvailability(),this.getTotalQuantity());a?a.merge(b):a=b}}),a},updatePricesAndAvailability:function(){b.each(this.groups,function(){this.updatePricesAndAvailability()})},getRootGroupsMaxPosition:function(){var a=0;return this.$element.find("> .form-group:not([data-parent])").each(function(){var c=b(this).data("position");c>a&&(a=c)}),a},sortGroups:function(){var a=this.$element.find("> .form-group");a.sort(function(a,c){var d=b(a).data("optionGroup").getPosition(),e=b(c).data("optionGroup").getPosition();return d!==e?d>e?1:-1:0}),a.detach().appendTo(this.$element)}}),b.fn.optionGroups=function(a){return this.each(function(){void 0===b(this).data("optionGroups")&&new h(b(this),a)})},b.extend(i.prototype,{init:function(){if(this.item.$gallery&&(this.$image=this.item.$gallery.find("> a"),1===this.$image.size())){this.$image.data("href",this.$image.attr("href")).data("title",this.$image.attr("title"));var a=this.$image.find("img");a.data("src",a.attr("src"))}this.$info=this.$element.closest(".input-group").find(".sale-item-info"),this.selectVariant(),this.bindEvents()},bindEvents:function(){var a=this;this.$element.on("change",function(){a.selectVariant()})},unbindEvents:function(){this.$element.off("change")},destroy:function(){this.unbindEvents(),this.$element.removeData()},selectVariant:function(){this.$element.trigger("pre_change",[this.variant,"variant"]),this.variant=void 0;var a=this.$element.find('option[value="'+this.$element.val()+'"]').eq(0);if(1===a.size()&&a.data("config")&&(this.variant=b.extend({id:this.$element.val(),label:null,thumb:null,image:null,pricing:null,availability:null,groups:[]},a.data("config"),{label:a.text()})),this.updatePricesAndAvailability(),this.$image)if(this.hasVariant()&&this.variant.thumb)this.$image.attr("href",this.variant.image).attr("title",this.variant.label).find("img").attr("src",this.variant.thumb);else{this.$image.attr("href",this.$image.data("href")).attr("title",this.$image.data("title"));var c=this.$image.find("img");c.attr("src",c.data("src"))}this.$element.trigger("post_change",[this.variant,"variant"])},updatePricesAndAvailability:function(){if(this.$info.empty(),this.$element.closest(".form-group").removeClass("has-error has-warning"),this.hasVariant()){var a=this.item.getTotalQuantity(),b=m.resolve.call(this.variant.availability,a),c=l.display.call(this.variant.pricing,a);b.hasClass()&&this.$element.closest(".form-group").addClass("has-"+b.getClass()),this.$info.html(b.display()+c)}},getName:function(){return this.name},hasVariant:function(){return!!this.variant},getVariant:function(){return this.variant},getOptionGroups:function(){return this.variant.groups}}),b.fn.variant=function(a){return this.each(function(){void 0===b(this).data("variant")&&new i(b(this),a)})},j.trans={quantity:"Quantity",discount:"Discount",unit_price:"Unit price",total:"Net total",rule_table:"Your prices",price_table:"Detailed unit price",ati:"ATI",net:"Net"},b.extend(j.prototype,{init:function(){this.config=b.extend({id:null,price:0,pricing:{price:0,offers:[],taxes:[]},availability:null,privileged:!1},this.$element.data("config"));var a=this.$element.data("globals");a&&(l.mode=a.mode,l.currency=a.currency);var c=this.$element.data("trans");c&&(j.trans=c),this.$gallery=void 0;var d=b("#"+this.id+"_gallery");1===d.size()&&(this.$gallery=d),this.$quantity=this.$element.find("#"+this.id+"_quantity"),this.quantity=parseFloat(this.$quantity.val()),this.totalQuantity=this.quantity,this.parentItem&&(this.totalQuantity=this.quantity*this.parentItem.getTotalQuantity(),this.$parentQuantity=this.$quantity.parent().find(".sale-item-parent-qty"),0===this.$parentQuantity.size()&&(this.$parentQuantity=b('<span class="input-group-addon sale-item-parent-qty"></span>'),this.$parentQuantity.insertBefore(this.$quantity)),this.updateParentQuantity()),this.$pricing=this.$element.find("#"+this.id+"_pricing"),this.$offers=this.$element.find("#"+this.id+"_offers"),this.$optionGroups=this.$element.find("#"+this.id+"_options").optionGroups(this),this.optionGroups=this.$optionGroups.data("optionGroups");var e=this.$element.find("#"+this.id+"_variant");if(1===e.size()&&(this.$variant=e.variant(this),this.variant=e.data("variant"),this.variant.hasVariant())){var f=this.variant.getVariant();this.optionGroups.createGroups(f.groups,"variant")}var g=this;b.each(this.optionGroups.getGroups(),function(a,b){if(!b.hasOption())return!0;var c=b.getOption();g.optionGroups.createGroups(c.groups,b.getId())});var h=[];if(this.$bundleSlots=this.$element.find("#"+this.id+"_configuration > .bundle-slot"),0<this.$bundleSlots.size()&&this.$bundleSlots.bundleSlot(this).each(function(){h.push(b(this).data("bundleSlot"))}),this.bundleSlots=h,this.$availability=this.parentItem?this.$element.find(".sale-item-availability"):this.$element.find(".sale-item-inner .sale-item-availability"),this.$submitButton=void 0,!this.parentItem&&(this.$submitButton=this.$element.find("button[type=submit]"),0===this.$submitButton.size()&&(this.$submitButton=this.$element.closest(".modal-content").find(".bootstrap-dialog-footer button#submit")),0===this.$submitButton.size()))throw"Submit button not found";this.optionGroups.sortGroups(),this.bindEvents(),this.onChange()},bindEvents:function(){var a=this;this.$variant&&(this.$variant.on("pre_change",function(b,c,d){c&&a.optionGroups.lockGroups(d)}),this.$variant.on("post_change",function(b,c,d){c&&a.optionGroups.createGroups(c.groups,d),a.onChange()})),this.$optionGroups.on("pre_change",function(b,c,d){c&&a.optionGroups.lockGroups(d)}),this.$optionGroups.on("post_change",function(b,c,d){c&&a.optionGroups.createGroups(c.groups,d),a.onChange()}),this.$bundleSlots.on("change",function(){a.onChange()}),this.$element.on("child_change",function(b){return b.preventDefault(),b.stopPropagation(),a.onChildChange(),!1}),this.$quantity.on("keyup change mouseup",function(){a.onQuantityChange()})},unbindEvents:function(){this.$variant&&(this.$variant.off("pre_change"),this.$variant.off("post_change")),this.$optionGroups.off("pre_change"),this.$optionGroups.off("post_change"),this.$bundleSlots.off("change"),this.$element.off("child_change"),this.$quantity.off("keyup change mouseup")},destroy:function(){this.unbindEvents(),this.variant&&this.variant.destroy(),b.each(this.bundleSlots,function(){this.destroy()}),this.optionGroups.destroy(),this.$element.removeData()},updateParentQuantity:function(){1<this.parentItem.getQuantity()?this.$parentQuantity.show().html(this.parentItem.getQuantity()+"x"):this.$parentQuantity.hide()},onQuantityChange:function(){this.quantity=parseFloat(this.$quantity.val()),this.totalQuantity=this.quantity,this.parentItem&&(this.updateParentQuantity(),this.totalQuantity=this.quantity*this.parentItem.getTotalQuantity()),this.variant&&this.variant.updatePricesAndAvailability(),this.optionGroups.updatePricesAndAvailability(),b.each(this.bundleSlots,function(){this.updateQuantity()}),this.onChange()},onChildChange:function(){b.each(this.bundleSlots,function(){this.updateState()})},onChange:function(){this.updatePricesAndAvailability(),this.parentItem&&this.parentItem.$element.trigger("child_change")},resolveAvailability:function(){var a=null;return 0<this.bundleSlots.length?b.each(this.bundleSlots,function(){if(this.hasChoice()){var b=this.getChoice().resolveAvailability();a?a.merge(b):a=b}}):a=this.variant&&this.variant.hasVariant()?m.resolve.call(this.variant.getVariant().availability,this.getTotalQuantity()):m.resolve.call(this.config.availability,this.getTotalQuantity()),a.merge(this.optionGroups.resolveAvailability()),a},updatePricesAndAvailability:function(){var a=this,d="",e=this.config.pricing,f=this.resolveAvailability();if(this.originalUnit=0,this.originalPrice=0,this.finalPrice=0,this.$availability.empty(),this.$quantity.closest(".form-group").removeClass("has-error has-warning"),this.$submitButton&&this.$submitButton.prop("disabled",!1),0<this.bundleSlots.length?b.each(this.bundleSlots,function(){this.hasChoice()&&(a.originalUnit+=this.getChoice().getOriginalPrice(),a.finalPrice+=this.getChoice().getFinalPrice())}):(this.variant&&this.variant.hasVariant()&&(e=this.variant.getVariant().pricing),this.originalUnit=l.calculate.call(e,this.totalQuantity,!1,!0),this.originalPrice=l.calculate.call(e,this.totalQuantity,!1,!1),this.finalPrice=l.calculate.call(e,this.totalQuantity,!0,!1)),this.originalUnit+=this.optionGroups.getOriginalPrice(),this.originalPrice+=this.optionGroups.getOriginalPrice()*this.totalQuantity,this.finalPrice+=this.optionGroups.getFinalPrice()*this.totalQuantity,0<this.originalPrice&&this.originalPrice!==this.finalPrice&&(d="<del>"+this.originalPrice.localizedCurrency(l.currency)+"</del>&nbsp;"),d+="<strong>"+this.finalPrice.localizedCurrency(l.currency)+"</strong>&nbsp;<sup>"+j.trans[l.mode]+"</sup>",this.$pricing.html(d),0<e.offers.length){var g=[],h=null;b.each(e.offers,function(b,c){g.push({min:Number(c.min_qty).localizedNumber(),max:h?Number(h).localizedNumber():null,percent:Math.fRound(c.percent,2).localizedNumber(),price:Number(a.originalUnit*(1-c.percent/100)).localizedCurrency(l.currency)}),h=c.min_qty-1}),this.$offers.html(c["@EkynaProduct/Js/sale_item_offers.html.twig"].render({trans:j.trans,offers:g.reverse(),quantity:this.totalQuantity}))}else this.$offers.empty();f.hasClass()&&(this.$quantity.closest(".form-group").addClass("has-"+f.getClass()),3!==f.level||this.parentItem||!this.$submitButton||this.config.privileged||this.$submitButton.prop("disabled",!0)),this.$availability.html(f.display())},getConfig:function(){return this.config},getQuantity:function(){return this.quantity},getTotalQuantity:function(){return this.totalQuantity},getOriginalPrice:function(){return this.originalPrice},getFinalPrice:function(){return this.finalPrice}}),b.fn.saleItem=function(a){return this.each(function(){void 0===b(this).data("saleItem")&&new j(b(this),a)})},b(document).on("click",".sale-item-configure .item-gallery a",function(c){c.preventDefault(),c.stopPropagation();var d=String(b(this).attr("href"));return d.length&&a(["fancybox"],function(){b.fancybox.open({src:d,caption:b(this).attr("title"),protect:!0})}),!1}),{init:function(a){a.saleItem()},destroy:function(a){var b=a.data("saleItem");void 0!==b&&b.destroy()}}});