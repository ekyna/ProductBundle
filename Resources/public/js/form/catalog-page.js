define(["jquery","routing","ekyna-form","ekyna-spinner"],function(r,l,c){"use strict";return r.fn.catalogPageWidget=function(){return this.each(function(){var e=r(this),t=e.find("select.catalog-page-template"),a=e.find("div.catalog-page-form"),i=null,o=null;if(1!==t.length||1!==a.length)throw"Unexpected form composition";function n(){o&&(o.abort(),o=null),i&&i.destroy();var n=t.val();a.loadingSpinner(),(o=r.ajax({url:l.generate("admin_ekyna_product_catalog_page_form",{template:n,name:e.attr("name")}),dataType:"xml"})).done(function(n){a.loadingSpinner("off").empty();n=r(n).find("form");1===n.length&&(a.empty().append(r(n.text()).children()),(i=c.create(a)).init())})}t.on("change",n),a.is(":empty")&&n()}),this},{init:function(n){n.catalogPageWidget()}}});