define(["jquery","routing","ekyna-form","ekyna-ui"],function(a,b,c){"use strict";return a.fn.catalogPageWidget=function(){return this.each(function(){function d(){i&&(i.abort(),i=null),h&&h.destroy();var d=f.val();g.loadingSpinner(),i=a.ajax({url:b.generate("ekyna_product_catalog_admin_page_form",{template:d,name:e.attr("name")}),dataType:"xml"}),i.done(function(b){g.loadingSpinner("off").empty();var d=a(b).find("form");1===d.length&&(g.empty().append(a(d.text()).children()),h=c.create(g),h.init())})}var e=a(this),f=e.find("select.catalog-page-template"),g=e.find("div.catalog-page-form"),h=null,i=null;if(1!==f.length||1!==g.length)throw"Unexpected form composition";f.on("change",d),g.is(":empty")&&d()}),this},{init:function(a){a.catalogPageWidget()}}});