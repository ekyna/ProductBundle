define(["jquery","jquery-ui/widget"],function(a){"use strict";function b(a){this.$element=a,this.$element.data("bundleRules",this),this.locked=!1,this.$group=this.$element.closest(".form-group"),this.init()}function c(a,b){this.$element=a,this.slotIndex=b,this.$element.data("bundleChoice",this),this.init()}function d(a,b){this.$element=a,this.$element.data("bundleChoices",this),this.slotIndex=b,this.init()}function e(a){this.$element=a,this.$element.data("bundleSlot",this),this.init()}function f(a){this.$element=a,this.$element.data("bundleSlots",this),this.init()}return b.prototype.init=function(){},b.prototype.save=function(){this.locked},b.prototype.destroy=function(){},b.prototype.lock=function(){this.locked||(this.locked=!0,this.$group.hide().find("select,input").prop("disabled",!0))},b.prototype.unlock=function(){this.locked&&(this.locked=!1,this.$group.show().find("select,input").prop("disabled",!1))},a.fn.bundleRules=function(){return this.each(function(){void 0===a(this).data("bundleRules")&&new b(a(this))})},c.prototype.init=function(){this.$number=a('<span class="bundle-choice-index"></span>').appendTo(this.$element),this.update()},c.prototype.save=function(){},c.prototype.destroy=function(){},c.prototype.setSlotIndex=function(a){this.slotIndex=a,this.update()},c.prototype.update=function(){this.$number.text(this.slotIndex+"."+this.$element.index())},a.fn.bundleChoice=function(b){return this.each(function(){void 0===a(this).data("bundleChoice")&&new c(a(this),b)})},d.prototype.init=function(){this.$choices=this.$element.find("> ul > li").bundleChoice(this.slotIndex);var b=a.proxy(this.onChange,this);this.$element.on("ekyna-collection-field-added",b),this.$element.on("ekyna-collection-field-removed",b),this.$element.on("ekyna-collection-field-moved-up",b),this.$element.on("ekyna-collection-field-moved-down",b)},d.prototype.save=function(){},d.prototype.destroy=function(){},d.prototype.setSlotIndex=function(b){this.slotIndex=b,this.$choices.each(function(){a(this).data("bundleChoice").setSlotIndex(b)})},d.prototype.onChange=function(){var b=this.slotIndex;this.$choices=this.$element.find("> ul > li").bundleChoice(this.slotIndex).each(function(){a(this).data("bundleChoice").setSlotIndex(b)})},a.fn.bundleChoices=function(b){return this.each(function(){void 0===a(this).data("bundleChoices")&&new d(a(this),b)})},e.prototype.init=function(){this.id=this.$element.attr("id");var b=this.$element.index();this.$number=a('<span class="bundle-slot-index"></span>').text(b).appendTo(this.$element),this.$required=this.$element.find("#"+this.id+"_required"),this.$rules=this.$element.find("#"+this.id+"_rules").bundleRules(),this.$choices=this.$element.find("#"+this.id+"_choices").bundleChoices(b),this.$required.on("change",a.proxy(this.onRequiredChange,this)),this.onRequiredChange()},e.prototype.save=function(){this.$rules.data("bundleRules").save()},e.prototype.update=function(){var a=this.$element.index();this.$number.text(a),this.$choices.data("bundleChoices").setSlotIndex(a)},e.prototype.destroy=function(){this.$required.off("change")},e.prototype.onRequiredChange=function(){this.$required.is(":checked")?this.$rules.data("bundleRules").lock():this.$rules.data("bundleRules").unlock()},a.fn.bundleSlot=function(){return this.each(function(){void 0===a(this).data("bundleSlot")&&new e(a(this))})},f.prototype.init=function(){this.$slots=this.$element.find("> ul > li").bundleSlot();var b=a.proxy(this.onChange,this);this.$element.on("ekyna-collection-field-added",b),this.$element.on("ekyna-collection-field-removed",b),this.$element.on("ekyna-collection-field-moved-up",b),this.$element.on("ekyna-collection-field-moved-down",b)},f.prototype.save=function(){this.$slots.each(function(){a(this).data("bundleSlot").save()})},f.prototype.destroy=function(){this.$element.off("ekyna-collection-field-added"),this.$element.off("ekyna-collection-field-removed"),this.$element.off("ekyna-collection-field-moved-up"),this.$element.off("ekyna-collection-field-moved-down"),this.$slots.each(function(){a(this).data("bundleSlot").destroy()})},f.prototype.onChange=function(){this.$slots=this.$element.find("> ul > li").bundleSlot().each(function(){a(this).data("bundleSlot").update()})},a.fn.bundleSlots=function(){return this.each(function(){void 0===a(this).data("bundleSlots")&&new f(a(this))})},{init:function(a){a.bundleSlots()},save:function(a){var b=a.data("bundleSlots");void 0!==b&&b.destroy()},destroy:function(a){var b=a.data("bundleSlots");void 0!==b&&b.destroy()}}});