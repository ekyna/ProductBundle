define(["jquery"],function(s){"use strict";function t(t){this.$element=t,this.$element.data("bundleRules",this),this.locked=!1,this.$group=this.$element.closest(".form-group"),this.init()}function i(t,e,i){this.$element=t,this.$element.data("bundleChoice",this),this.configurable=e,this.slotIndex=i,this.$product=t.find("#"+t.attr("id")+"_product"),this.$options=t.find("#"+t.attr("id")+"_excludedOptionGroups"),this.init()}function n(t,e,i){this.$element=t,this.$element.data("bundleChoices",this),this.configurable=e,this.slotIndex=i,this.init()}function e(t,e){this.$element=t,this.$element.data("bundleSlot",this),this.configurable=e,this.init()}function o(t){this.$element=t,this.$element.data("bundleSlots",this),this.configurable=t.hasClass("configurable"),this.init()}return t.prototype.init=function(){},t.prototype.save=function(){this.locked},t.prototype.destroy=function(){},t.prototype.lock=function(){this.locked||(this.locked=!0,this.$group.hide().find("select,input").prop("disabled",!0))},t.prototype.unlock=function(){this.locked&&(this.locked=!1,this.$group.show().find("select,input").prop("disabled",!1))},s.fn.bundleRules=function(){return this.each(function(){void 0===s(this).data("bundleRules")&&new t(s(this))})},i.prototype.init=function(){this.configurable&&(this.$number=s('<span class="bundle-choice-index"></span>').appendTo(this.$element),this.update()),this.$product.on("change",s.proxy(this.onProductChange,this))},i.prototype.save=function(){},i.prototype.destroy=function(){this.$product.off("change")},i.prototype.setSlotIndex=function(t){this.slotIndex=t,this.configurable&&this.update()},i.prototype.update=function(){this.configurable&&this.$number.text(this.slotIndex+"."+this.$element.index())},i.prototype.onProductChange=function(){this.$options.empty();var i=this.$options,n=this.$options.attr("id"),o=this.$options.data("name"),t=this.$product.select2("data");if(t.length){t=t[0];if(!t.hasOwnProperty("option_groups")){if(!t.hasOwnProperty("element"))return;t=s(t.element).data("entity")}t.hasOwnProperty("option_groups")&&s.each(t.option_groups,function(t,e){s('<label for="'+n+"_"+t+'" class="checkbox-inline"><input type="checkbox" id="'+n+"_"+t+'" name="'+o+'[]" value="'+e.id+'" checked="checked">['+(e.required?"Required":"Optional")+"] "+e.name+"</label>").appendTo(i)})}},s.fn.bundleChoice=function(t,e){return this.each(function(){void 0===s(this).data("bundleChoice")&&new i(s(this),t,e)})},n.prototype.init=function(){var t;this.$choices=this.$element.find("> ul > li").bundleChoice(this.configurable,this.slotIndex),this.configurable&&(t=s.proxy(this.onChange,this),this.$element.on("ekyna-collection-field-added",t),this.$element.on("ekyna-collection-field-removed",t),this.$element.on("ekyna-collection-field-moved-up",t),this.$element.on("ekyna-collection-field-moved-down",t))},n.prototype.save=function(){},n.prototype.destroy=function(){},n.prototype.setSlotIndex=function(t){this.slotIndex=t,this.configurable&&this.$choices.each(function(){s(this).data("bundleChoice").setSlotIndex(t)})},n.prototype.onChange=function(){var t;this.configurable&&(t=this.slotIndex,this.$choices=this.$element.find("> ul > li").bundleChoice(this.configurable,this.slotIndex).each(function(){s(this).data("bundleChoice").setSlotIndex(t)}))},s.fn.bundleChoices=function(t,e){return this.each(function(){void 0===s(this).data("bundleChoices")&&new n(s(this),t,e)})},e.prototype.init=function(){this.id=this.$element.attr("id");var t=this.$element.index();this.$choices=this.$element.find("#"+this.id+"_choices").bundleChoices(this.configurable,t),this.configurable&&(this.$number=s('<span class="bundle-slot-index"></span>').text(t).appendTo(this.$element),this.$required=this.$element.find("#"+this.id+"_required"),this.$rules=this.$element.find("#"+this.id+"_rules").bundleRules(),this.$required.on("change",s.proxy(this.onRequiredChange,this)),this.onRequiredChange())},e.prototype.save=function(){this.configurable&&this.$rules.data("bundleRules").save()},e.prototype.update=function(){var t;this.configurable&&(t=this.$element.index(),this.$number.text(t),this.$choices.data("bundleChoices").setSlotIndex(t))},e.prototype.destroy=function(){this.configurable&&this.$required.off("change")},e.prototype.onRequiredChange=function(){this.configurable&&(this.$required.is(":checked")?this.$rules.data("bundleRules").lock():this.$rules.data("bundleRules").unlock())},s.fn.bundleSlot=function(t){return this.each(function(){void 0===s(this).data("bundleSlot")&&new e(s(this),t)})},o.prototype.init=function(){this.$slots=this.$element.find("> ul > li").bundleSlot(this.configurable);var t=s.proxy(this.onChange,this);this.$element.on("ekyna-collection-field-added",t),this.$element.on("ekyna-collection-field-removed",t),this.$element.on("ekyna-collection-field-moved-up",t),this.$element.on("ekyna-collection-field-moved-down",t)},o.prototype.save=function(){this.$slots.each(function(){s(this).data("bundleSlot").save()})},o.prototype.destroy=function(){this.$element.off("ekyna-collection-field-added"),this.$element.off("ekyna-collection-field-removed"),this.$element.off("ekyna-collection-field-moved-up"),this.$element.off("ekyna-collection-field-moved-down"),this.$slots.each(function(){s(this).data("bundleSlot").destroy()})},o.prototype.onChange=function(){this.$slots=this.$element.find("> ul > li").bundleSlot(this.configurable).each(function(){s(this).data("bundleSlot").update()})},s.fn.bundleSlots=function(){return this.each(function(){void 0===s(this).data("bundleSlots")&&new o(s(this))})},{init:function(t){t.bundleSlots()},save:function(t){t=t.data("bundleSlots");void 0!==t&&t.destroy()},destroy:function(t){t=t.data("bundleSlots");void 0!==t&&t.destroy()}}});