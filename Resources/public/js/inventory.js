define(["jquery","routing","ekyna-product/templates","ekyna-modal"],function(a,b,c,d){function e(){for(var a=o.serializeArray(),b={},c=0;c<a.length;c++)b[a[c].name]=a[c].value;return b}function f(){i&&i.abort(),k.empty(),l.show(),m.hide(),q=!1,r=-1,g()}function g(){i&&i.abort(),q||(p=!0,r++,i=a.ajax({url:b.generate("ekyna_product_inventory_admin_products",{page:r}),method:"GET",dataType:"json",data:e()}),i.done(function(b){void 0===b.products||0===b.products.length?(0===r&&m.show(),l.hide(),q=!0):(30>b.products.length&&(l.hide(),q=!0),a.each(b.products,function(b,d){a(c["inventory_line.html.twig"].render(d)).appendTo(k)}))}),i.always(function(){p=!1}))}function h(c,e){if(c.preventDefault(),c.stopPropagation(),p)return!1;p=!0;var g=a(c.currentTarget).parents("tr").eq(0).data("id");if(!g)return console.log("Undefined product id."),!1;try{var h=new d;h.load({url:b.generate(e,{productId:g}),method:"GET"}),a(h).on("ekyna.modal.response",function(a){p=!1,"json"===a.contentType&&(a.preventDefault(),a.content.success&&f(),a.modal.close())})}catch(i){console.log(i),p=!1}return!1}var i,j=a(window),k=a("#inventory_list"),l=a("#inventory_wait"),m=a("#inventory_none"),n=a("#inventory_sort"),o=a('form[name="inventory"]'),p=!1,q=!1,r=-1;j.on("scroll",function(){p||q||(console.log(j.scrollTop(),l.offset().top),j.scrollTop()+j.height()>l.offset().top&&g())}),o.on("submit",function(a){return a.preventDefault(),a.stopPropagation(),f(),!1}),o.on("reset",function(){f()}),k.on("click","a.print-label",function(c){var d=a(c.currentTarget).parents("tr").eq(0).data("id");if(!d)return console.log("Undefined product id."),!1;var e=b.generate("ekyna_product_product_admin_label",{format:"large",id:[d]}),f=window.open(e,"_blank");f.focus()}),k.on("click","a.quick-edit",function(a){return h(a,"ekyna_product_inventory_admin_quick_edit")}),k.on("click","a.stock-units",function(a){return h(a,"ekyna_product_inventory_admin_stock_units")}),k.on("click","a.treatment",function(a){return h(a,"ekyna_product_inventory_admin_customer_orders")}),k.on("click","a.resupply",function(a){return h(a,"ekyna_product_inventory_admin_resupply")}),n.on("click","th.sort a",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget),d="none";return c.hasClass("none")?d="asc":c.hasClass("asc")&&(d="desc"),n.find("th.sort a").removeClass("asc desc").addClass("none"),"none"!==d?(c.removeClass("none").addClass(d),o.find('input[name="inventory[sortBy]"]').val(c.data("by")),o.find('input[name="inventory[sortDir]"]').val(d)):(o.find('input[name="inventory[sortBy]"]').val(null),o.find('input[name="inventory[sortDir]"]').val(null)),o.trigger("submit"),!1}),f()});