define(["require","jquery","routing","ekyna-dispatcher","ekyna-product/templates","ekyna-modal","ekyna-admin/barcode-scanner","ekyna-clipboard-copy"],function(n,d,u,s,p,f,y){var e,_=d(window),m=d("#inventory thead"),o=d("#inventory tbody"),k=d("#inventory tfoot"),t=d("#inventory_wait").detach(),v=d("#inventory_none").detach(),a=d('form[name="inventory"]'),c=!1;var r=!1,i=-1;function h(){e&&e.abort(),o.empty(),r=!1,i=-1,g()}function g(){e&&e.abort(),r||(c=!0,v.detach(),t.appendTo(o),i++,(e=d.ajax({url:u.generate("admin_ekyna_product_inventory_products",{page:i}),method:"GET",dataType:"json",data:function(){for(var n=a.serializeArray(),e={},t=0;t<n.length;t++)n[t].value&&(e[n[t].name]=n[t].value);return e}()})).done(T),e.always(function(){c=!1}))}function b(){var n=_.height()-a.outerHeight()-m.outerHeight()-k.outerHeight();o.height(n=n<0?0:n)}function l(n,e,t,o){if(n.preventDefault(),n.stopPropagation(),c)return!1;if(o=o||T,(c=!0)===(t=t||{})){n=d(n.currentTarget).parents("tr").eq(0).data("id");if(!n)return console.log("Undefined product id."),!1;t={productId:n}}try{var a=new f;a.load({url:u.generate(e,t),method:"GET"}),d(a).on("ekyna.modal.response",function(n){c=!1,"json"===n.contentType&&(n.preventDefault(),o(n.content),n.modal.close())}),d(a).on("ekyna.modal.load_fail",function(){c=!1})}catch(n){console.log(n),c=!1}return!1}function T(n){if(!n.hasOwnProperty("products")||0===n.products.length)return 0===i&&v.appendTo(o),void(r=!0);n.update||t.detach(),d.each(n.products,function(n,e){var t=d(p["@EkynaProduct/Js/inventory_line.html.twig"].render(e)),e=o.find("tr[data-id="+e.id+"]");1===e.length?e.replaceWith(t):t.appendTo(o)}),n.update||(n.products.length<30?r=!0:t.appendTo(o))}y.init({}),y.addListener(function(n){e&&e.abort(),o.empty(),v.detach(),t.appendTo(o),c=!(r=!1),i=0,(e=d.ajax({url:u.generate("admin_ekyna_product_inventory_products",{page:i}),method:"GET",dataType:"json",data:{referenceCode:n}})).done(T),e.always(function(){c=!1})}),o.on("click","a.bookmark",function(n){var e=d(n.currentTarget).closest("a"),t=e.hasClass("fa-bookmark-o"),o=t?"admin_ekyna_product_product_bookmark_add":"admin_ekyna_product_product_bookmark_remove",a=!0,r=t?"POST":"DELETE",i=function(){t?e.removeClass("fa-bookmark-o").addClass("fa-bookmark"):e.removeClass("fa-bookmark").addClass("fa-bookmark-o")};if(r=r||"GET",n.preventDefault(),n.stopPropagation(),c)return!1;if((c=!0)===(a=a||{})){n=d(n.currentTarget).parents("tr").eq(0).data("id");if(!n)return console.log("Undefined product id."),!1;a={productId:n}}(n=d.ajax({url:u.generate(o,a),method:r})).done(i||T),n.always(function(){c=!1})}),o.on("click","a.quick-edit",function(n){return l(n,"admin_ekyna_product_inventory_quick_edit",!0)}),o.on("click","a.print-label",function(n){n=d(n.currentTarget).parents("tr").eq(0).data("id");if(!n)return console.log("Undefined product id."),!1;n=u.generate("admin_ekyna_product_product_label",{format:"large",id:[n]});window.open(n,"_blank").focus()}),a.on("submit",function(n){return n.preventDefault(),n.stopPropagation(),h(),!1}),a.on("reset",function(){a.find("table input").val(null).attr("value",null),a.find("table select").val(null).find("option").prop("selected",!1),h()}),o.on("click","a.quick-edit",function(n){return l(n,"admin_ekyna_product_inventory_quick_edit",!0)}),o.on("click","a.stock-units",function(n){return l(n,"admin_ekyna_product_inventory_stock_units",!0)}),o.on("click","a.treatment",function(n){return l(n,"admin_ekyna_product_inventory_customer_orders",!0)}),o.on("click","a.resupply",function(n){return l(n,"admin_ekyna_product_inventory_resupply",!0)}),d('button[name="batch_submit"]').on("click",function(n){var e=[];return d("#inventory").serializeArray().forEach(function(n){e.push(n.value)}),e.length<=1?(alert("Please select some products"),!1):l(n,"admin_ekyna_product_inventory_batch_edit",{id:e})}),m.on("click","th.sort a",function(n){n.preventDefault(),n.stopPropagation();var n=d(n.currentTarget),e="none";return n.hasClass("none")?e="asc":n.hasClass("asc")&&(e="desc"),m.find("th.sort a").removeClass("asc desc").addClass("none"),"none"!==e?(n.removeClass("none").addClass(e),a.find('input[name="inventory[sortBy]"]').val(n.data("by")),a.find('input[name="inventory[sortDir]"]').val(e)):(a.find('input[name="inventory[sortBy]"]').val(null),a.find('input[name="inventory[sortDir]"]').val(null)),a.trigger("submit"),!1}),s.on("ekyna_commerce.stock_units.change",function(){h()}),h(),_.on("resize",b),b(),o.on("scroll",function(){c||r||t.offset().top<o.height()+a.outerHeight()+m.outerHeight()&&g()}),n(["ekyna-admin/summary"],function(n){n.init()}),n(["ekyna-admin/side-detail"],function(n){n.init()})});