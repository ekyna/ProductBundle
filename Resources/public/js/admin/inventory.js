define(["require","jquery","routing","ekyna-dispatcher","ekyna-product/templates","ekyna-modal","ekyna-admin/barcode-scanner","ekyna-clipboard-copy"],function(a,b,c,d,e,f,g){function h(){for(var a=w.serializeArray(),b={},c=0;c<a.length;c++)a[c].value&&(b[a[c].name]=a[c].value);return b}function i(){w.find("table input").val(null).attr("value",null),w.find("table select").val(null).find("option").prop("selected",!1)}function j(){p&&p.abort(),s.empty(),y=!1,z=-1,k()}function k(){p&&p.abort(),y||(x=!0,v.detach(),u.appendTo(s),z++,p=b.ajax({url:c.generate("admin_ekyna_product_inventory_products",{page:z}),method:"GET",dataType:"json",data:h()}),p.done(o),p.always(function(){x=!1}))}function l(){var a=q.height()-w.outerHeight()-r.outerHeight()-t.outerHeight();0>a&&(a=0),s.height(a)}function m(a,d,e,f,g){if(f=f||"GET",a.preventDefault(),a.stopPropagation(),x)return!1;if(x=!0,e=e||{},!0===e){var h=b(a.currentTarget).parents("tr").eq(0).data("id");if(!h)return console.log("Undefined product id."),!1;e={productId:h}}var i=b.ajax({url:c.generate(d,e),method:f});i.done(g||o),i.always(function(){x=!1})}function n(a,d,e,g){if(a.preventDefault(),a.stopPropagation(),x)return!1;if(x=!0,e=e||{},g=g||o,!0===e){var h=b(a.currentTarget).parents("tr").eq(0).data("id");if(!h)return console.log("Undefined product id."),!1;e={productId:h}}try{var i=new f;i.load({url:c.generate(d,e),method:"GET"}),b(i).on("ekyna.modal.response",function(a){x=!1,"json"===a.contentType&&(a.preventDefault(),g(a.content),a.modal.close())}),b(i).on("ekyna.modal.load_fail",function(){x=!1})}catch(j){console.log(j),x=!1}return!1}function o(a){return a.hasOwnProperty("products")&&0!==a.products.length?(a.update||u.detach(),b.each(a.products,function(a,c){var d=b(e["@EkynaProduct/Js/inventory_line.html.twig"].render(c)),f=s.find("tr[data-id="+c.id+"]");1===f.length?f.replaceWith(d):d.appendTo(s)}),a.update?void 0:30>a.products.length?void(y=!0):void u.appendTo(s)):(0===z&&v.appendTo(s),void(y=!0))}var p,q=b(window),r=b("#inventory thead"),s=b("#inventory tbody"),t=b("#inventory tfoot"),u=b("#inventory_wait").detach(),v=b("#inventory_none").detach(),w=b('form[name="inventory"]'),x=!1,y=!1,z=-1;g.init({}),g.addListener(function(a){p&&p.abort(),s.empty(),v.detach(),u.appendTo(s),y=!1,x=!0,z=0,p=b.ajax({url:c.generate("admin_ekyna_product_inventory_products",{page:z}),method:"GET",dataType:"json",data:{referenceCode:a}}),p.done(o),p.always(function(){x=!1})}),s.on("click","a.bookmark",function(a){var c=b(a.currentTarget).closest("a"),d=c.hasClass("fa-bookmark-o"),e=d?"admin_ekyna_product_product_bookmark_add":"admin_ekyna_product_product_bookmark_remove";return m(a,e,!0,d?"POST":"DELETE",function(){d?c.removeClass("fa-bookmark-o").addClass("fa-bookmark"):c.removeClass("fa-bookmark").addClass("fa-bookmark-o")})}),s.on("click","a.quick-edit",function(a){return n(a,"admin_ekyna_product_inventory_quick_edit",!0)}),s.on("click","a.print-label",function(a){var d=b(a.currentTarget).parents("tr").eq(0).data("id");if(!d)return console.log("Undefined product id."),!1;var e=c.generate("admin_ekyna_product_product_label",{format:"large",id:[d]}),f=window.open(e,"_blank");f.focus()}),w.on("submit",function(a){return a.preventDefault(),a.stopPropagation(),j(),!1}),w.on("reset",function(){i(),j()}),s.on("click","a.quick-edit",function(a){return n(a,"admin_ekyna_product_inventory_quick_edit",!0)}),s.on("click","a.stock-units",function(a){return n(a,"admin_ekyna_product_inventory_stock_units",!0)}),s.on("click","a.treatment",function(a){return n(a,"admin_ekyna_product_inventory_customer_orders",!0)}),s.on("click","a.resupply",function(a){return n(a,"admin_ekyna_product_inventory_resupply",!0)}),b('button[name="batch_submit"]').on("click",function(a){var c=[];return b("#inventory").serializeArray().forEach(function(a){c.push(a.value)}),1>=c.length?(alert("Please select some products"),!1):n(a,"admin_ekyna_product_inventory_batch_edit",{id:c})}),r.on("click","th.sort a",function(a){a.preventDefault(),a.stopPropagation();var c=b(a.currentTarget),d="none";return c.hasClass("none")?d="asc":c.hasClass("asc")&&(d="desc"),r.find("th.sort a").removeClass("asc desc").addClass("none"),"none"!==d?(c.removeClass("none").addClass(d),w.find('input[name="inventory[sortBy]"]').val(c.data("by")),w.find('input[name="inventory[sortDir]"]').val(d)):(w.find('input[name="inventory[sortBy]"]').val(null),w.find('input[name="inventory[sortDir]"]').val(null)),w.trigger("submit"),!1}),d.on("ekyna_commerce.stock_units.change",function(){j()}),j(),q.on("resize",l),l(),s.on("scroll",function(){x||y||u.offset().top<s.height()+w.outerHeight()+r.outerHeight()&&k()}),a(["ekyna-admin/summary"],function(a){a.init()}),a(["ekyna-admin/side-detail"],function(a){a.init()})});