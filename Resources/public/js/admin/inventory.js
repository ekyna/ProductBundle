define(["require","jquery","routing","ekyna-product/templates","ekyna-modal","ekyna-admin/barcode-scanner","ekyna-clipboard-copy"],function(s,t,r,i,p,f){const d=t("#inventory_list"),u=t("#inventory_wait"),h=t("#inventory_none"),a="admin_ekyna_product_inventory_app_",y=t("#reload_list"),e=t("#display_zero"),n=t("#display_valid"),o=t("#display_end_of_life");let l=!1,v=e.prop("checked"),k=n.prop("checked"),m=o.prop("checked");function c(){v?d.addClass("display-zero"):d.removeClass("display-zero"),k?d.addClass("display-valid"):d.removeClass("display-valid"),m?d.addClass("display-end-of-life"):d.removeClass("display-end-of-life")}function _(){l||(l=!0,u.show(),h.hide(),d.empty(),fetch(r.generate(a+"list"),{headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("Failed to fetch product list");return e.json()}).then(e=>{if(console.log(e),e.hasOwnProperty("products")&&e.products instanceof Array)if(0!==e.products.length){for(const n of e.products)t(i["@EkynaProduct/Js/inventory_line.html.twig"].render(n)).appendTo(d);c()}else h.show()}).finally(()=>{l=!1,u.hide()}))}function g(e){const n=t(i["@EkynaProduct/Js/inventory_line.html.twig"].render(e)),o=d.find("div[data-id="+e.id+"]");1===o.length?o.replaceWith(n):n.appendTo(d)}function w(e,n,o){if(confirm(o)){o=t(e.currentTarget).parents("div").eq(1).data("id");if(!o)throw new Error("Undefined id");if(l)return!1;l=!0,fetch(r.generate(a+n,{id:o}),{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("Request failed");return e.json()}).then(e=>{console.log(e),e.hasOwnProperty("product")&&"object"==typeof e.product&&g(e.product)}).finally(()=>{l=!1})}}_(),y.on("click",()=>{y.blur(),_()}),e.on("change",()=>{v=e.prop("checked"),e.blur(),c()}),n.on("change",()=>{k=n.prop("checked"),n.blur(),c()}),o.on("change",()=>{m=o.prop("checked"),o.blur(),c()}),d.on("click","a.count",e=>{var n="count";if(!(e=t(e.currentTarget).parents("div").eq(1).data("id")))throw new Error("Undefined id");if(l)return!1;l=!0;try{const o=new p;o.load({url:r.generate(a+n,{id:e}),method:"GET"}),t(o).on("ekyna.modal.response",function(e){l=!1,"json"===e.contentType&&(e.preventDefault(),g(e.content.product),e.modal.close())}),t(o).on("ekyna.modal.load_fail",function(){l=!1})}catch(e){console.log(e),l=!1}return!1}),d.on("click","a.validate",e=>w(e,"validate","Valider le stock ?")),d.on("click","a.end-of-life",e=>w(e,"end_of_life","Confirmer «En fin de vie» ?")),f.init({}),f.addListener(e=>{d.find("> div").removeClass("focus");let n=d.find('div[data-gtin="'+e+'"]');0!==n.length&&(n.addClass("focus"),e=n.offset().top,t("html, body").scrollTop(e-50))})});