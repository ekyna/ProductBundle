define(["jquery","routing","ekyna-dispatcher","ekyna-product/templates","ekyna-modal"],function(a,b,c,d,e){function f(){for(var a=p.serializeArray(),b={},c=0;c<a.length;c++)b[a[c].name]=a[c].value;return b}function g(){j&&j.abort(),l.empty(),m.show(),n.hide(),r=!1,s=-1,h()}function h(){j&&j.abort(),r||(q=!0,s++,j=a.ajax({url:b.generate("ekyna_product_inventory_admin_products",{page:s}),method:"GET",dataType:"json",data:f()}),j.done(function(b){void 0===b.products||0===b.products.length?(0===s&&n.show(),m.hide(),r=!0):(30>b.products.length&&(m.hide(),r=!0),a.each(b.products,function(b,c){a(d["inventory_line.html.twig"].render(c)).appendTo(l)}))}),j.always(function(){q=!1}))}function i(c,d){if(c.preventDefault(),c.stopPropagation(),q)return!1;q=!0;var f=a(c.currentTarget).parents("tr").eq(0).data("id");if(!f)return console.log("Undefined product id."),!1;try{var h=new e;h.load({url:b.generate(d,{productId:f}),method:"GET"}),a(h).on("ekyna.modal.response",function(a){q=!1,"json"===a.contentType&&(a.preventDefault(),a.content.success&&g(),a.modal.close())})}catch(i){console.log(i),q=!1}return!1}var j,k=a(window),l=a("#inventory_list"),m=a("#inventory_wait"),n=a("#inventory_none"),o=a("#inventory_sort"),p=a('form[name="inventory"]'),q=!1,r=!1,s=-1;k.on("scroll",function(){q||r||k.scrollTop()+k.height()>m.offset().top&&h()}),p.on("submit",function(a){return a.preventDefault(),a.stopPropagation(),g(),!1}),p.on("reset",function(){g()}),l.on("click","a.print-label",function(c){var d=a(c.currentTarget).parents("tr").eq(0).data("id");if(!d)return console.log("Undefined product id."),!1;var e=b.generate("ekyna_product_product_admin_label",{format:"large",id:[d]}),f=window.open(e,"_blank");f.focus()}),l.on("click","a.quick-edit",function(a){return i(a,"ekyna_product_inventory_admin_quick_edit")}),l.on("click","a.stock-units",function(a){return i(a,"ekyna_product_inventory_admin_stock_units")}),l.on("click","a.treatment",function(a){return i(a,"ekyna_product_inventory_admin_customer_orders")}),l.on("click","a.resupply",function(a){return i(a,"ekyna_product_inventory_admin_resupply")}),o.on("click","th.sort a",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget),d="none";return c.hasClass("none")?d="asc":c.hasClass("asc")&&(d="desc"),o.find("th.sort a").removeClass("asc desc").addClass("none"),"none"!==d?(c.removeClass("none").addClass(d),p.find('input[name="inventory[sortBy]"]').val(c.data("by")),p.find('input[name="inventory[sortDir]"]').val(d)):(p.find('input[name="inventory[sortBy]"]').val(null),p.find('input[name="inventory[sortDir]"]').val(null)),p.trigger("submit"),!1}),c.on("ekyna_commerce.stock_units.change",function(){g()}),g()});