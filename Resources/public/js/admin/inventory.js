define(["jquery","routing","ekyna-dispatcher","ekyna-product/templates","ekyna-modal"],function(a,b,c,d,e){function f(){for(var a=u.serializeArray(),b={},c=0;c<a.length;c++)a[c].value&&(b[a[c].name]=a[c].value);return b}function g(){u.find("table input").val(null).attr("value",null),u.find("table select").val(null).find("option").prop("selected",!1)}function h(){n&&n.abort(),q.empty(),w=!1,x=-1,i()}function i(){n&&n.abort(),w||(v=!0,t.detach(),s.appendTo(q),x++,n=a.ajax({url:b.generate("ekyna_product_inventory_admin_products",{page:x}),method:"GET",dataType:"json",data:f()}),n.done(m),n.always(function(){v=!1}))}function j(){var a=o.height()-u.outerHeight()-p.outerHeight()-r.outerHeight();0>a&&(a=0),q.height(a)}function k(c,d,e,f,g){if(f=f||"GET",c.preventDefault(),c.stopPropagation(),v)return!1;if(v=!0,e=e||{},!0===e){var h=a(c.currentTarget).parents("tr").eq(0).data("id");if(!h)return console.log("Undefined product id."),!1;e={productId:h}}var i=a.ajax({url:b.generate(d,e),method:f});i.done(g||m),i.always(function(){v=!1})}function l(c,d,f,g){if(c.preventDefault(),c.stopPropagation(),v)return!1;if(v=!0,f=f||{},g=g||m,!0===f){var h=a(c.currentTarget).parents("tr").eq(0).data("id");if(!h)return console.log("Undefined product id."),!1;f={productId:h}}try{var i=new e;i.load({url:b.generate(d,f),method:"GET"}),a(i).on("ekyna.modal.response",function(a){v=!1,"json"===a.contentType&&(a.preventDefault(),g(a.content),a.modal.close())}),a(i).on("ekyna.modal.load_fail",function(){v=!1})}catch(j){console.log(j),v=!1}return!1}function m(b){return b.hasOwnProperty("products")&&0!==b.products.length?(b.update||s.detach(),a.each(b.products,function(b,c){var e=a(d["@EkynaProduct/Js/inventory_line.html.twig"].render(c)),f=q.find("tr[data-id="+c.id+"]");1===f.length?f.replaceWith(e):e.appendTo(q)}),b.update?void 0:30>b.products.length?void(w=!0):void s.appendTo(q)):(0===x&&t.appendTo(q),void(w=!0))}var n,o=a(window),p=a("#inventory thead"),q=a("#inventory tbody"),r=a("#inventory tfoot"),s=a("#inventory_wait").detach(),t=a("#inventory_none").detach(),u=a('form[name="inventory"]'),v=!1,w=!1,x=-1;q.on("click","a.bookmark",function(b){var c=a(b.currentTarget).closest("a"),d=c.hasClass("fa-bookmark-o"),e=d?"ekyna_product_product_bookmark_admin_add":"ekyna_product_product_bookmark_admin_remove";return k(b,e,!0,d?"POST":"DELETE",function(){d?c.removeClass("fa-bookmark-o").addClass("fa-bookmark"):c.removeClass("fa-bookmark").addClass("fa-bookmark-o")})}),q.on("click","a.quick-edit",function(a){return l(a,"ekyna_product_inventory_admin_quick_edit",!0)}),q.on("click","a.print-label",function(c){var d=a(c.currentTarget).parents("tr").eq(0).data("id");if(!d)return console.log("Undefined product id."),!1;var e=b.generate("ekyna_product_product_admin_label",{format:"large",id:[d]}),f=window.open(e,"_blank");f.focus()}),u.on("submit",function(a){return a.preventDefault(),a.stopPropagation(),h(),!1}),u.on("reset",function(){g(),h()}),q.on("click","a.quick-edit",function(a){return l(a,"ekyna_product_inventory_admin_quick_edit",!0)}),q.on("click","a.stock-units",function(a){return l(a,"ekyna_product_inventory_admin_stock_units",!0)}),q.on("click","a.treatment",function(a){return l(a,"ekyna_product_inventory_admin_customer_orders",!0)}),q.on("click","a.resupply",function(a){return l(a,"ekyna_product_inventory_admin_resupply",!0)}),a('button[name="batch_submit"]').on("click",function(b){var c=[];return a("#inventory").serializeArray().forEach(function(a){c.push(a.value)}),1>=c.length?(alert("Please select some products"),!1):l(b,"ekyna_product_inventory_admin_batch_edit",{id:c})}),p.on("click","th.sort a",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget),d="none";return c.hasClass("none")?d="asc":c.hasClass("asc")&&(d="desc"),p.find("th.sort a").removeClass("asc desc").addClass("none"),"none"!==d?(c.removeClass("none").addClass(d),u.find('input[name="inventory[sortBy]"]').val(c.data("by")),u.find('input[name="inventory[sortDir]"]').val(d)):(u.find('input[name="inventory[sortBy]"]').val(null),u.find('input[name="inventory[sortDir]"]').val(null)),u.trigger("submit"),!1}),c.on("ekyna_commerce.stock_units.change",function(){h()}),h(),o.on("resize",j),j(),q.on("scroll",function(){v||w||s.offset().top<q.height()+u.outerHeight()+p.outerHeight()&&i()})});