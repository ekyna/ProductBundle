define(["jquery","routing"],function(i,r){var d=i("#highlight"),o=d.find("tbody > tr"),u=!1;function c(e){if(e){if(u)return;d.find("th.sort a").addClass("disabled"),d.find("input, select").prop("disabled",!0)}else{if(!u)return;d.find("th.sort a").removeClass("disabled"),d.find("input, select").prop("disabled",!1)}u=e}function a(a,n){var r,s;u||(c(!0),o.sort("id"===a||"visible"===a||"visibility"===a||"bestseller"===a||"crossselling"===a?function(e,t){return r=parseInt(e.getAttribute("data-"+a)),s=parseInt(t.getAttribute("data-"+a)),"asc"===n?r-s:"desc"===n?s-r:0}:function(e,t){if(r=e.getAttribute("data-"+a).toLowerCase(),s=t.getAttribute("data-"+a).toLowerCase(),"asc"===n){if(s<r)return 1;if(r<s)return-1}else if("desc"===n){if(r<s)return 1;if(s<r)return-1}return 0}).detach().appendTo(d.find("tbody")),c(!1))}d.on("click","a.quick-edit",function(e){return request(e,"admin_ekyna_product_stock_view_quick_edit")}),d.on("click","th.sort a",function(e){e.preventDefault(),e.stopPropagation();var e=i(e.currentTarget),t="none";return!e.hasClass("disabled")&&(e.hasClass("none")?t="asc":e.hasClass("asc")&&(t="desc"),d.find("th.sort a").removeClass("asc desc").addClass("none"),"none"===t?(d.find('th.sort a[data-property="id"]').addClass("asc"),a("id","asc")):(e.removeClass("none").addClass(t),a(e.data("property"),t)),!1)}),d.on("change",".filters input, .filters select",function(e){e.preventDefault(),e.stopPropagation();var a,t,n,r,e=i(e.currentTarget),s=e.val();return e.prop("disabled")||(""===s?o.show():(a=e.prop("name"),t=e.val(),u||(c(!0),r="brand"===a||"designation"===a||"reference"===a?(n=new RegExp(t,"i"),function(e){return n.test(e)}):function(e){return e===t},o.each(function(e,t){r(t.getAttribute("data-"+a))?i(t).show():i(t).hide()}),c(!1)))),!1}),d.on("change",".products input, .products select",function(e){var t,a,n;if(!u)return e.preventDefault(),e.stopPropagation(),t=i(e.currentTarget),a=t.closest("tr"),n=t.prop("name"),e=t.val(),a.addClass("warning"),t.prop("disabled")||(c(!0),"visible"===n&&(e=e?1:0),i.ajax({url:r.generate("admin_ekyna_product_highlight_update",{productId:a.data("id")}),method:"POST",dataType:"json",data:{property:n,value:e}}).done(function(e){a.removeClass("warning danger").addClass("success"),a.data(n,e[n]),a.attr("data-"+n,e[n]),setTimeout(function(){a.removeClass("success")},1500)}).fail(function(){"visible"===n?t.prop("checked",!!a.data("visible")):t.val(a.data(n)),a.removeClass("warning success").addClass("danger")}).always(function(){c(!1)})),!1})});