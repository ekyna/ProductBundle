define(["jquery","routing"],function(a,b){function c(a){if(a){if(h)return;f.find("th.sort a").addClass("disabled"),f.find("input, select").prop("disabled",!0)}else{if(!h)return;f.find("th.sort a").removeClass("disabled"),f.find("input, select").prop("disabled",!1)}h=a}function d(a,b){if(!h){c(!0);var d,e,i;i="id"===a||"visible"===a||"visibility"===a||"bestseller"===a||"crossselling"===a?function(c,f){return d=parseInt(c.getAttribute("data-"+a)),e=parseInt(f.getAttribute("data-"+a)),"asc"===b?d-e:"desc"===b?e-d:0}:function(c,f){if(d=c.getAttribute("data-"+a).toLowerCase(),e=f.getAttribute("data-"+a).toLowerCase(),"asc"===b){if(d>e)return 1;if(d<e)return-1}else if("desc"===b){if(d<e)return 1;if(d>e)return-1}return 0},g.sort(i).detach().appendTo(f.find("tbody")),c(!1)}}function e(b,d){if(!h){c(!0);var e;if("brand"===b||"designation"===b||"reference"===b){var f=new RegExp(d,"i");e=function(a){return f.test(a)}}else e=function(a){return a===d};g.each(function(c,d){e(d.getAttribute("data-"+b))?a(d).show():a(d).hide()}),c(!1)}}var f=a("#highlight"),g=f.find("tbody > tr"),h=!1;f.on("click","a.quick-edit",function(a){return request(a,"admin_ekyna_product_inventory_quick_edit")}),f.on("click","th.sort a",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget),e="none";return!c.hasClass("disabled")&&(c.hasClass("none")?e="asc":c.hasClass("asc")&&(e="desc"),f.find("th.sort a").removeClass("asc desc").addClass("none"),"none"===e?(f.find('th.sort a[data-property="id"]').addClass("asc"),d("id","asc"),!1):(c.removeClass("none").addClass(e),d(c.data("property"),e),!1))}),f.on("change",".filters input, .filters select",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget),d=c.val();return!c.prop("disabled")&&(""===d?(g.show(),!1):(e(c.prop("name"),c.val()),!1))}),f.on("change",".products input, .products select",function(d){if(!h){d.preventDefault(),d.stopPropagation();var e=a(d.currentTarget),f=e.closest("tr"),g=e.prop("name"),i=e.val();return f.addClass("warning"),!e.prop("disabled")&&(c(!0),"visible"===g&&(i=i?1:0),a.ajax({url:b.generate("admin_ekyna_product_highlight_update",{productId:f.data("id")}),method:"POST",dataType:"json",data:{property:g,value:i}}).done(function(a){f.removeClass("warning danger").addClass("success"),f.data(g,a[g]),f.attr("data-"+g,a[g]),setTimeout(function(){f.removeClass("success")},1500)}).fail(function(){"visible"===g?e.prop("checked",!!f.data("visible")):e.val(f.data(g)),f.removeClass("warning success").addClass("danger")}).always(function(){c(!1)}),!1)}})});